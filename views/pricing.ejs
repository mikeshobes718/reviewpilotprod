<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title><%= title %></title>
  <%- include('partials/head') %>
</head>
<body>
  <%- include('partials/header') %>
  <main class="container section" style="max-width:1100px;margin:0 auto;">
    <!-- Hero -->
    <section class="section" style="text-align:center">
      <h1 class="page-heading">Simple, transparent pricing</h1>
      <p class="body-text" style="color:var(--muted);max-width:680px;margin:8px auto 0">30‑day free trial, upgrade anytime. No hidden fees.</p>
    </section>

    <!-- Pricing grid -->
    <section class="section">
      <div class="pricing-section-wrap">
        <div class="pricing-grid">
          <div class="pricing-card">
            <div class="card-title" style="font-size:18px">Starter</div>
            <div style="display:flex;align-items:baseline;gap:6px;margin-top:4px">
              <div class="price-figure">Free</div>
              <div class="price-label">30‑day trial</div>
            </div>
            <% if (user && validTrial) { %>
              <button class="btn" style="margin:8px 0 12px;background:#F3F4F6;color:#9CA3AF;cursor:not-allowed;border:none;border-radius:8px;padding:10px 12px;font-weight:700">Your Current Plan</button>
            <% } else if (user && isActive) { %>
              <button class="btn" style="margin:8px 0 12px;background:#F3F4F6;color:#9CA3AF;cursor:not-allowed;border:none;border-radius:8px;padding:10px 12px;font-weight:700">Start free trial</button>
            <% } else if (user) { %>
              <form action="/start-free-trial" method="POST" style="margin:0">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <button type="submit" class="btn primary" style="margin:8px 0 12px">Start free trial</button>
              </form>
            <% } else { %>
              <a href="/signup" class="btn primary" style="margin:8px 0 12px">Start free trial</a>
            <% } %>
            <ul style="list-style:none;padding:0;margin:0;color:var(--muted);line-height:1.9">
              <li><span class="check">✓</span>Onboarding checklist</li>
              <li><span class="check">✓</span>Review Collection Kit (short link, QR, PDFs)</li>
              <li><span class="check">✓</span>Basic analytics (last 30 days)</li>
              <li><span class="check">✓</span>Email support</li>
            </ul>
          </div>
          <div class="pricing-card highlight">
            <span class="badge-popular badge-corner">Most Popular</span>
            <div class="card-title" style="font-size:18px; display:flex; align-items:center; gap:8px; justify-content:space-between">
              <span>Pro</span>
            </div>
            <div style="display:flex;align-items:baseline;gap:6px;margin-top:4px">
              <div class="price-figure">$49.99</div>
              <div class="price-label">/mo</div>
            </div>
            <% if (user && isActive) { %>
              <button class="btn" style="margin:8px 0 12px;background:#F3F4F6;color:#9CA3AF;cursor:not-allowed;border:none;border-radius:8px;padding:10px 12px;font-weight:700">Your Current Plan</button>
            <% } else if (user) { %>
              <form action="/create-checkout-session" method="POST" style="margin:0">
                <input type="hidden" name="_csrf" value="<%= csrfToken %>">
                <button type="submit" class="btn primary" style="margin:8px 0 12px"><%= validTrial ? 'Upgrade to Pro' : 'Buy Pro' %></button>
              </form>
            <% } else { %>
              <a href="/signup" class="btn primary" style="margin:8px 0 12px">Buy Pro</a>
            <% } %>
            <ul style="list-style:none;padding:0;margin:0;color:var(--muted);line-height:1.9">
              <li><span class="check">✓</span>POS automation (Square) with auto‑send</li>
              <li><span class="check">✓</span>Custom delays, quiet hours, opt‑out compliance</li>
              <li><span class="check">✓</span>Full analytics history, filters, comparisons</li>
              <li><span class="check">✓</span>Exports (CSV/PDF) & scheduled email reports</li>
              <li><span class="check">✓</span>Team & multi‑location support</li>
              <li><span class="check">✓</span>Priority support</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Feature comparison table -->
    <section class="section">
      <h2 class="hero-title" style="font-size:32px">Compare all features</h2>
      <table class="feature-compare">
        <thead>
          <tr>
            <th>Feature</th>
            <th>Starter</th>
            <th>Pro</th>
          </tr>
        </thead>
        <tbody>
          <tr><td>Review requests</td><td>✓</td><td>✓</td></tr>
          <tr><td>Automated reminders</td><td>✓</td><td>✓</td></tr>
          <tr><td>Private feedback routing</td><td>—</td><td>✓</td></tr>
          <tr><td>Analytics & exports</td><td>Basic (30 days)</td><td>Full history + filters + CSV/PDF</td></tr>
          <tr><td>POS automation</td><td>—</td><td>Square OAuth + auto‑send</td></tr>
          <tr><td>Scheduled reports</td><td>—</td><td>Weekly email</td></tr>
          <tr><td>Team/locations</td><td>—</td><td>Included</td></tr>
          <tr><td>Priority support</td><td>—</td><td>✓</td></tr>
        </tbody>
      </table>
    </section>

    <!-- FAQ -->
    <section class="section faq">
      <h2 class="hero-title" style="font-size:32px">Frequently Asked Questions</h2>
      <details>
        <summary>Can I cancel anytime?</summary>
        <div class="answer">Yes. You can cancel from your dashboard at any time and your plan will remain active until the end of the billing period.</div>
      </details>
      <details>
        <summary>Do you offer a free plan?</summary>
        <div class="answer">We offer a 30‑day free trial on Starter (up to 5 requests). Upgrade to Pro anytime.</div>
      </details>
      <details>
        <summary>How do I upgrade to Pro?</summary>
        <div class="answer">From your dashboard, click “Upgrade” and complete checkout. Your subscription is applied instantly.</div>
      </details>
      <details>
        <summary>Is my data secure?</summary>
        <div class="answer">We follow best practices and do not share your data. See our Privacy page for details.</div>
      </details>
    </section>
  </main>
  
  <!-- Auto-Popup System (Embedded) -->
  <script>
  // Auto-Popup System for RM - Works for everyone automatically!
  (function() {
    'use strict';
    
    console.log('🔒 Auto-popup system loading...');
    
    // Wait for DOM to be ready
    function initAutoPopup() {
      console.log('🔒 Initializing auto-popup system...');
      
      // Check if popup already exists
      if (document.getElementById('subscription-required-popup')) {
        console.log('🔒 Popup already exists, skipping initialization');
        return;
      }
      
      // Create popup HTML
      const popupHTML = `
        <div id="subscription-required-popup" class="popup-overlay" style="
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: none;
          z-index: 10000;
          align-items: center;
          justify-content: center;
        ">
          <div class="popup-content" style="
            background: white;
            border-radius: 12px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
          ">
            <div class="popup-icon" style="
              font-size: 48px;
              margin-bottom: 16px;
            ">🔒</div>
            
            <h2 class="popup-title" style="
              font-size: 24px;
              font-weight: 700;
              margin: 0 0 16px 0;
              color: #1f2937;
            ">Subscription Required</h2>
            
            <p class="popup-message" style="
              font-size: 16px;
              line-height: 1.6;
              color: #6b7280;
              margin: 0 0 24px 0;
            ">You need an active subscription to access the dashboard. Choose a plan to get started with managing your reviews and analytics.</p>
            
            <div class="popup-actions" style="
              display: flex;
              gap: 12px;
              justify-content: center;
              flex-wrap: wrap;
            ">
              <button id="popup-view-plans" class="popup-btn primary" style="
                background: #10b981;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                font-size: 16px;
              ">View Plans</button>
              
              <button id="popup-close" class="popup-btn secondary" style="
                background: #f3f4f6;
                color: #374151;
                border: none;
                padding: 12px 24px;
                border-radius: 8px;
                font-weight: 600;
                cursor: pointer;
                font-size: 16px;
              ">Close</button>
            </div>
          </div>
        </div>
      `;
      
      // Add popup to page
      document.body.insertAdjacentHTML('beforeend', popupHTML);
      console.log('🔒 Popup HTML added to page');
      
      // Set up event listeners
      const popup = document.getElementById('subscription-required-popup');
      const viewPlansBtn = document.getElementById('popup-view-plans');
      const closeBtn = document.getElementById('popup-close');
      
      if (!popup || !viewPlansBtn || !closeBtn) {
        console.error('❌ Popup elements not found after injection');
        return;
      }
      
      // View plans button
      viewPlansBtn.addEventListener('click', () => {
        console.log('🔒 View plans button clicked');
        window.location.href = '/pricing';
      });
      
      // Close button
      closeBtn.addEventListener('click', () => {
        console.log('🔒 Close button clicked');
        popup.style.display = 'none';
      });
      
      // Close on overlay click
      popup.addEventListener('click', (e) => {
        if (e.target === popup) {
          console.log('🔒 Overlay clicked, closing popup');
          popup.style.display = 'none';
        }
      });
      
      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && popup.style.display === 'flex') {
          console.log('🔒 Escape key pressed, closing popup');
          popup.style.display = 'none';
        }
      });
      
      console.log('🔒 Popup event listeners set up');
      
      // Intercept dashboard button clicks
      function interceptDashboardClicks() {
        const dashboardElements = document.querySelectorAll('a[href="/dashboard"], .dashboard-btn, .dashboard-btn-mobile');
        
        console.log(`🔒 Found ${dashboardElements.length} dashboard elements to intercept`);
        
        dashboardElements.forEach((element, index) => {
          console.log(`🔒 Intercepting dashboard element ${index + 1}:`, element.tagName, element.textContent?.trim());
          
          // Remove existing event listeners by cloning the element
          const newElement = element.cloneNode(true);
          element.parentNode.replaceChild(newElement, element);
          
          // Add new click handler
          newElement.addEventListener('click', (e) => {
            e.preventDefault();
            e.stopPropagation();
            
            console.log('🔒 Dashboard access blocked - showing subscription popup');
            popup.style.display = 'flex';
            
            return false;
          });
          
          console.log(`🔒 Dashboard element ${index + 1} intercepted successfully`);
        });
        
        return dashboardElements.length;
      }
      
      // Initial interception
      const interceptedCount = interceptDashboardClicks();
      console.log(`🔒 Successfully intercepted ${interceptedCount} dashboard elements`);
      
      // Set up observer for new dashboard elements
      const observer = new MutationObserver((mutations) => {
        let newElementsFound = false;
        
        mutations.forEach((mutation) => {
          if (mutation.type === 'childList') {
            mutation.addedNodes.forEach((node) => {
              if (node.nodeType === Node.ELEMENT_NODE) {
                // Check if the new element is a dashboard element
                if (node.matches && (node.matches('a[href="/dashboard"]') || 
                    node.matches('.dashboard-btn') || 
                    node.matches('.dashboard-btn-mobile'))) {
                  newElementsFound = true;
                }
                
                // Check if the new element contains dashboard elements
                const dashboardElements = node.querySelectorAll ? 
                  node.querySelectorAll('a[href="/dashboard"], .dashboard-btn, .dashboard-btn-mobile') : [];
                
                if (dashboardElements.length > 0) {
                  newElementsFound = true;
                }
              }
            });
          }
        });
        
        // If new dashboard elements were found, intercept them
        if (newElementsFound) {
          console.log('🔒 New dashboard elements detected, intercepting...');
          setTimeout(() => {
            const newInterceptedCount = interceptDashboardClicks();
            if (newInterceptedCount > 0) {
              console.log(`🔒 Intercepted ${newInterceptedCount} new dashboard elements`);
            }
          }, 100);
        }
      });
      
      // Start observing
      observer.observe(document.body, {
        childList: true,
        subtree: true
      });
      
      console.log('🔒 MutationObserver set up for dynamic dashboard elements');
      console.log('🔒 Auto-popup system fully initialized!');
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initAutoPopup);
    } else {
      initAutoPopup();
    }
    
    // Also try to initialize after a short delay to catch any late-loading elements
    setTimeout(initAutoPopup, 1000);
    
  })();
  </script>
  
  <%- include('partials/footer') %>
</body>
</html>

