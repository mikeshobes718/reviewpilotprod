<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= (business && business.businessName) ? ('Rate ' + business.businessName) : 'Rate Your Experience' %> • Reviews &amp; Marketing</title>
    <meta name="csrf-token" content="<%= csrfToken %>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <%- include('partials/head') %>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; min-height:100vh; margin:0; background: var(--bg); color: var(--text); display:block; }
        .public-wrap{ display:flex; align-items:center; justify-content:center; min-height: 100vh; padding: 24px 16px; box-sizing: border-box }
        .public-card{ background: var(--card); border:1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); max-width: 560px; width: 100%; padding: 28px; text-align:center }
        .biz-logo{ width: 80px; height: 80px; object-fit: contain; border-radius: 12px; border:1px solid var(--border); background:#fff; display:block; margin:0 auto 12px }
        .modal-title{ font-size: 28px; font-weight: 800; margin: 0 0 6px; color: var(--text); text-align:center }
        .modal-sub{ color: var(--muted); margin:0 0 16px; text-align:center }
        .hidden { display: none; }
        .stars { display:flex; justify-content:center; align-items:center; gap:10px; font-size:44px; color: #CBD5E0; cursor:pointer; transition: transform 0.2s ease }
        .star {
             transition: color 0.2s ease, transform 0.2s ease;
        }
        .star:hover {
            transform: scale(1.2);
        }
        .star.selected { color: var(--accent) }
        h2 { font-size: 20px; font-weight: 700 }
        p { color: var(--muted); line-height:1.6; margin-bottom: 16px }
        form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            text-align: left;
        }
        input, textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(16,185,129,.2);
        }
        .branding { margin: 16px auto 0; font-size: 0.875rem; color: var(--muted); text-align:center }
        .branding a { color: var(--accent); text-decoration:none; font-weight:600 }
    </style>
</head>
<body>
    <div id="rate-root" data-business-id="<%= business.uid %>" data-place-id="<%= business.googlePlaceId || '' %>" class="public-wrap">
      <div class="public-card">
        <% const logo = (business && (business.logoUrl || business.logo)) ? (business.logoUrl || business.logo) : '/logos/main-logo.png'; %>
        <img class="biz-logo" src="<%= logo %>" alt="<%= (business && business.businessName) ? business.businessName + ' logo' : 'Business logo' %>">
        <div class="modal-title"><%= (business && business.businessName) ? business.businessName : 'Our Business' %></div>
        <p class="modal-sub">How was your experience at <%= (business && business.businessName) ? business.businessName : 'our business' %>?</p>

        <!-- Initial Rating Section -->
        <div id="rating-section">
            <div class="stars">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
        </div>

        <!-- 1-3 Star Feedback Form -->
        <div id="contact-section" class="hidden" style="margin-top:16px">
            <h2 id="contact-title">Tell us a bit about you</h2>
            <p id="contact-subtitle">Please share your contact info. If your rating is 4 or below, also tell us how we can improve.</p>
            <form id="contact-form">
                <input type="text" id="name" placeholder="Your Name" required>
                <input type="email" id="email" placeholder="Your Email" required>
                <input type="tel" id="phone" placeholder="Your Phone (Optional)">
                <div id="feedback-wrapper" class="hidden">
                    <textarea id="feedback-text" placeholder="How could we have made it a 5-star experience?" rows="4"></textarea>
                </div>
                <button type="submit" class="btn-primary">Submit</button>
            </form>
        </div>

        <!-- Thank You Message -->
        <div id="thank-you-section" class="hidden" style="margin-top:16px">
            <h2>Thank you!</h2>
            <p>We appreciate you taking the time to help us improve.</p>
        </div>
      </div>
    </div>

    <% if (hcaptchaSiteKey) { %>
    <div class="hidden">
        <div class="h-captcha" data-sitekey="<%= hcaptchaSiteKey %>"></div>
    </div>
    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
    <% } %>

    <script src="/rate.js" defer></script>
    <%- include('partials/public_footer') %>
</body>
</html>

