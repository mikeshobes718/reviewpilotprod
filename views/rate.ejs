<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= (typeof placeDisplayName !== 'undefined' && placeDisplayName) ? ('Rate ' + placeDisplayName) : ((business && business.businessName) ? ('Rate ' + business.businessName) : 'Rate Your Experience') %> • Reviews &amp; Marketing</title>
    <meta name="csrf-token" content="<%= csrfToken %>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <%- include('partials/head') %>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; min-height:100vh; margin:0; background: var(--bg); color: var(--text); display:block; }
        .public-wrap{ display:flex; align-items:center; justify-content:center; min-height: 100vh; padding: 24px 16px; box-sizing: border-box }
        .public-card{ background: var(--card); border:1px solid var(--border); border-radius: 16px; box-shadow: var(--shadow); max-width: 560px; width: 100%; padding: 28px; text-align:center }
        .biz-logo{ width: 80px; height: 80px; object-fit: contain; border-radius: 12px; border:1px solid var(--border); background:#fff; display:block; margin:0 auto 12px }
        .modal-title{ font-size: 28px; font-weight: 800; margin: 0 0 6px; color: var(--text); text-align:center }
        .modal-sub{ color: var(--muted); margin:0 0 16px; text-align:center }
        .hidden { display: none; }
        .stars { display:flex; justify-content:center; align-items:center; gap:10px; font-size:44px; color: #CBD5E0; cursor:pointer; transition: transform 0.2s ease }
        .star {
             transition: color 0.2s ease, transform 0.2s ease;
        }
        .star:hover {
            transform: scale(1.2);
        }
        .star.selected { color: var(--accent) }
        .google-ctx { display:flex; align-items:center; justify-content:center; gap:8px; font-size: 12px; color: var(--muted); margin: 8px 0 16px }
        .google-g { width: 14px; height: 14px; display:inline-block; }
        h2 { font-size: 20px; font-weight: 700 }
        p { color: var(--muted); line-height:1.6; margin-bottom: 16px }
        form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            text-align: left;
        }
        input, textarea {
            width: 100%;
            box-sizing: border-box;
            padding: 12px 14px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Inter', sans-serif;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(16,185,129,.2);
        }
        .branding { margin: 16px auto 0; font-size: 0.875rem; color: var(--muted); text-align:center }
        .branding a { color: var(--accent); text-decoration:none; font-weight:600 }
    </style>
</head>
<body>
    <div id="rate-root" data-business-id="<%= business.uid %>" data-place-id="<%= business.googlePlaceId || '' %>" class="public-wrap">
      <div class="public-card">
        <!-- Standard star icon for all businesses -->
        <svg class="biz-logo" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 2.5l2.89 5.86 6.47.94-4.68 4.56 1.1 6.43L12 17.77l-5.78 3.02 1.1-6.43L2.64 9.3l6.47-.94L12 2.5z" fill="#FBBF24" stroke="#F59E0B" stroke-width="0.5"/>
        </svg>
        <div class="modal-title"><%= (typeof placeDisplayName !== 'undefined' && placeDisplayName) ? placeDisplayName : (business && business.businessName ? business.businessName : 'Business') %></div>
        <p class="modal-sub">How was your experience at <%= (typeof placeDisplayName !== 'undefined' && placeDisplayName) ? placeDisplayName : (business && business.businessName ? business.businessName : 'our business') %>?</p>

        <!-- Initial Rating Section -->
        <div id="rating-section">
            <div class="stars">
                <span class="star" data-value="1">★</span>
                <span class="star" data-value="2">★</span>
                <span class="star" data-value="3">★</span>
                <span class="star" data-value="4">★</span>
                <span class="star" data-value="5">★</span>
            </div>
            <div class="google-ctx">
              <svg class="google-g" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path fill="#EA4335" d="M24 9.5c3.54 0 6 1.54 7.38 2.83l5.02-4.9C33.64 4.46 29.27 3 24 3 14.91 3 7.05 8.58 3.67 16.17l5.93 4.6C11.57 15.28 17.34 9.5 24 9.5z"/>
                <path fill="#4285F4" d="M46.5 24.5c0-1.64-.15-3.21-.43-4.72H24v9h12.68c-.55 2.96-2.24 5.46-4.76 7.14l7.29 5.66C43.93 37.78 46.5 31.61 46.5 24.5z"/>
                <path fill="#FBBC05" d="M9.6 28.77a14.5 14.5 0 010-9.54l-5.93-4.6a23.94 23.94 0 000 18.74l5.93-4.6z"/>
                <path fill="#34A853" d="M24 46c6.48 0 11.92-2.13 15.89-5.79l-7.29-5.66c-2.02 1.36-4.61 2.18-8.6 2.18-6.66 0-12.42-5.78-14.4-13.01l-5.93 4.6C7.05 39.42 14.91 46 24 46z"/>
                <path fill="none" d="M0 0h48v48H0z"/>
              </svg>
              <span>Help them shine on Google</span>
            </div>
        </div>

        <!-- Feedback (shown for 1–4 stars) -->
        <div id="feedback-section" class="hidden" style="margin-top:16px; text-align:left">
            <label for="feedback-text" style="display:block; font-weight:600; margin-bottom:6px">What would make this a 5‑star experience next time?</label>
            <textarea id="feedback-text" placeholder="Your feedback helps us improve." rows="5"></textarea>
            <button id="action-button" class="btn-primary" type="button" style="margin-top:10px; width:100%">Submit Feedback</button>
        </div>

        <!-- Thank You Message -->
        <div id="thank-you-section" class="hidden" style="margin-top:16px">
            <h2>Thank you!</h2>
            <p>We appreciate you taking the time to help us improve.</p>
        </div>
      </div>
    </div>

    <% if (hcaptchaSiteKey) { %>
    <div class="hidden">
        <div class="h-captcha" data-sitekey="<%= hcaptchaSiteKey %>"></div>
    </div>
    <script src="https://js.hcaptcha.com/1/api.js" async defer></script>
    <% } %>

    <script src="/rate.js" defer></script>
    <%- include('partials/public_footer') %>
</body>
</html>

